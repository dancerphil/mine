{"version":3,"sources":["components/Block.module.css","components/CastRange.module.css","utils.ts","constant.ts","region.ts","renderer.ts","components/Block.tsx","handlers.ts","components/useEventListener.tsx","components/CastRange.tsx","components/App.tsx","index.tsx","components/Theme2.module.css","components/App.module.css"],"names":["module","exports","windowWidth","window","innerWidth","windowHeight","innerHeight","size","Math","floor","yNumber","blockNumber","mineNumber","panelStyle","width","height","blockStyle","castRangeStyle","xyList","y","x","push","handleMark","block","mark","handleReveal","reveal","mine","Error","label","getSurroundingBlocks","forEach","applyDiff","diff","iterateeMaybeMine","computeSmartDiff","blocks","sumBy","filter","b","blockRegion","createMappedRegion","getBlock","getValue","useBlock","useValue","setBlock","set","getBlockList","compact","map","blockList","region","createRegion","rerender","v","useRender","Block","coordinate","className","cx","styles","theme","cover","style","start","handleReset","fillMap","mineCount","random","handleSmartRoot","handleBlockClick","i","fillMapUntilValid","diffList","flat","combineDiff","handleBlockClickWithCatch","e","console","error","currentCoordinateRegion","useCurrentCoordinate","setCurrentCoordinate","prev","resetCurrentCoordinate","reset","getCoordinate","element","clientX","clientY","rect","getBoundingClientRect","mouseX","left","scrollLeft","mouseY","top","scrollTop","withTouch","handler","preventDefault","changedTouches","withMouse","checkButtons","buttons","useEventListener","ref","useEffect","current","handleStart","handleTouchStart","handleMouseDown","handleMove","handleTouchMove","handleMouseMove","handleEnd","handleTouchEnd","handleMouseUp","document","body","addEventListener","passive","removeEventListener","CastRange","currentCoordinate","c","castRange","memo","App","useRef","header","onMouseUp","onTouchEnd","item","length","content","panel","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.49196f49.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Block_block__Gscjm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"castRange\":\"CastRange_castRange__1OIwm\"};","import {Block, Coordinate, Diff} from \"./types\";\nimport {getSurroundingBlocks} from \"./region\";\nimport {compact, sumBy} from \"lodash\";\nimport {intelligenceLevel, xNumber, yNumber} from \"./constant\";\n\nexport const xyList: Array<Coordinate> = [];\n\nfor (let y = 0; y < yNumber; y++) {\n    for (let x = 0; x < xNumber; x++) {\n        xyList.push({x, y});\n    }\n}\n\nexport const handleMark = (block: Block) => {\n    block.mark = true;\n};\n\nexport const handleReveal = (block: Block) => {\n    if (block.reveal) {\n        return;\n    }\n    block.reveal = true;\n    if (block.mine) {\n        block.mark = true;\n        // getBlockList().forEach(block => {\n        //     block.reveal = true;\n        // });\n        throw new Error('失败');\n    }\n    const {label} = block;\n    if (label === 0) {\n        // 这是一个深搜\n        getSurroundingBlocks(block).forEach(handleReveal);\n    }\n};\n\nexport const applyDiff = (diff: Diff) => {\n    const {mark, reveal} = diff;\n    if(mark) {\n        mark.forEach(handleMark);\n    }\n    if(reveal) {\n        reveal.forEach(handleReveal);\n    }\n};\n\nexport const combineDiff = (diffList: Diff[]) => {\n    const mark = compact(diffList.map(diff => diff.mark)).flat();\n    const reveal = compact(diffList.map(diff => diff.reveal)).flat();\n    return {mark, reveal};\n};\n\nconst iterateeMaybeMine = (block: Block) => {\n    // 已知是雷\n    if (block.reveal && block.mine) {\n        return 1;\n    }\n    // 未打开\n    if (!block.reveal) {\n        return 1;\n    }\n    return 0;\n};\n\nexport const computeSmartDiff = (block: Block): Diff => {\n    if (block.mine) {\n        return {};\n    }\n    const blocks = getSurroundingBlocks(block);\n    // 如果未打开的 block 数量正好，则把未打开的置为 mark\n    if (sumBy(blocks, iterateeMaybeMine) === block.label) {\n        return {\n            mark: blocks.filter(b => !b.reveal)\n        };\n    }\n\n    if (intelligenceLevel >= 1) {\n        // 如果 mark 的 block 数量正好，则把未打开的置为 reveal\n        if (sumBy(blocks, (block) => block.mark ? 1 : 0) === block.label) {\n            return {\n                reveal: blocks.filter(b => !b.mark)\n            };\n        }\n    }\n    return {};\n};\n","export const windowWidth = window.innerWidth;\nexport const windowHeight = window.innerHeight;\n\nexport const xNumber = 20;\nexport const size = Math.floor(windowWidth / xNumber);\nexport const yNumber = Math.floor(windowHeight * 0.95 / size); // 5vh header\nexport const blockNumber = xNumber * yNumber;\nexport const mineNumber = Math.floor(blockNumber * 0.2);\n// 0 mark，1 smart，2 reveal 时会 smart，3 smart 后会对周围 smart\nexport const intelligenceLevel = 3;\n\nexport const panelStyle = {width: xNumber * size, height: yNumber * size};\nexport const blockStyle = {width: size, height: size};\nexport const castRangeStyle = {width: size * 3, height: size * 3};\n","import {compact} from 'lodash';\nimport {createMappedRegion} from 'region-core';\nimport {Block, Coordinate} from './types';\nimport {xyList} from \"./utils\";\n\nconst blockRegion = createMappedRegion<Coordinate, Block>();\n\nexport const getBlock = blockRegion.getValue;\n\nexport const useBlock = blockRegion.useValue;\n\nexport const setBlock = blockRegion.set;\n\nexport const getBlockList = (): Block[] => compact(xyList.map(getBlock));\n\nexport const getSurroundingBlocks = (block: Block) => {\n    const {x, y} = block;\n    const blockList = [\n        getBlock({x: x - 1, y: y - 1}), getBlock({x: x - 1, y: y}), getBlock({x: x - 1, y: y + 1}),\n        getBlock({x: x, y: y - 1}), getBlock({x: x, y: y + 1}),\n        getBlock({x: x + 1, y: y - 1}), getBlock({x: x + 1, y: y}), getBlock({x: x + 1, y: y + 1}),\n    ];\n    return compact(blockList);\n};\n\nconst initBlock = () => {\n    xyList.forEach(({x, y}) => {\n        const block = {\n            x,\n            y,\n            mine: false,\n            reveal: false,\n            mark: false,\n            label: 0,\n        };\n        setBlock({x, y}, block);\n    });\n};\n\ninitBlock();\n","import {createRegion} from 'region-core';\n\nconst region = createRegion<number>(0);\n\nexport const rerender = () => region.set(v => v + 1);\n\nexport const useRender = region.useValue;\n","import React from 'react';\nimport cx from 'classnames';\nimport styles from './Block.module.css';\nimport theme from './Theme2.module.css';\nimport {useBlock} from \"../region\";\nimport {blockStyle as style} from '../constant';\nimport {Coordinate} from \"../types\";\n\ninterface Props {\n    coordinate: Coordinate\n}\n\nconst Block = ({coordinate}: Props) => {\n    const block = useBlock(coordinate);\n\n    if (!block) {\n        return null;\n    }\n\n    const {mine, reveal, mark, label} = block;\n\n    if (!reveal) {\n        const className = cx(\n            styles.block,\n            theme.cover,\n            {\n                [theme.mark]: mark,\n            }\n        );\n        return (\n            <div\n                className={className}\n                style={style}\n            >\n                {mark && 'm'}\n            </div>\n        );\n    }\n    const className = cx(\n        styles.block,\n        theme.reveal,\n        {\n            [theme[`label${label}`]]: !mine,\n            [theme.mine]: mine,\n        }\n    );\n    return (\n        <div\n            className={className}\n            style={style}\n        >\n            {mine ? '!' :  label}\n        </div>\n    );\n};\n\nexport default Block;\n","import {sumBy} from 'lodash';\nimport {rerender} from './renderer';\nimport {getBlock, getBlockList, getSurroundingBlocks} from './region';\nimport {Block, Coordinate} from './types';\nimport {intelligenceLevel, mineNumber, xNumber, yNumber} from \"./constant\";\nimport {applyDiff, combineDiff, computeSmartDiff, handleReveal} from \"./utils\";\n\nlet start = false;\n\nexport const handleReset = () => {\n    getBlockList().forEach((block) => {\n        block.reveal = false;\n        block.mark = false;\n    });\n    start = false;\n    rerender();\n};\n\nhandleReset();\n\nconst fillMap = () => {\n    getBlockList().forEach((block) => {\n        block.mine = false;\n    });\n\n    let mineCount = 0;\n    while (mineCount < mineNumber) {\n        const x = Math.floor(Math.random() * xNumber);\n        const y = Math.floor(Math.random() * yNumber);\n        const block = getBlock({x, y}) as Block;\n        if (!block.mine) {\n            block.mine = true;\n            mineCount ++;\n        }\n    }\n\n    getBlockList().forEach((block) => {\n        const blocks = getSurroundingBlocks(block);\n        block.label = sumBy(blocks, 'mine');\n    });\n};\n\nconst fillMapUntilValid = (block: Block) => {\n    for (let i = 0; i < 100; i++) {\n        fillMap();\n        if (!block.mine && block.label === 0) {\n            return;\n        }\n    }\n};\n\nconst handleSmartRoot = (block: Block) => {\n    const diff = computeSmartDiff(block);\n    applyDiff(diff);\n};\n\nexport const handleBlockClick = (coordinate: Coordinate) => {\n    const block = getBlock(coordinate);\n    if (!block){\n        return;\n    }\n    if (block.mark) {\n        return;\n    }\n    if (!start){\n        fillMapUntilValid(block);\n        start = true;\n    }\n    const {reveal} = block;\n    if (reveal) {\n        handleSmartRoot(block);\n    } else {\n        handleReveal(block);\n        if (intelligenceLevel >= 2) {\n            handleSmartRoot(block);\n        }\n    }\n\n    if (intelligenceLevel >= 3) {\n        const diffList = getSurroundingBlocks(block).filter(block => block.reveal).map(computeSmartDiff);\n        const diff = combineDiff(diffList);\n        applyDiff(diff);\n    }\n};\n\nexport const handleBlockClickWithCatch = (coordinate: Coordinate) => {\n    try {\n        handleBlockClick(coordinate);\n    } catch (e) {\n        console.error(e);\n    } finally {\n        rerender();\n    }\n};\n","import {useEffect, RefObject} from 'react';\nimport {createRegion} from 'region-core';\nimport {handleBlockClickWithCatch} from '../handlers';\nimport {size} from '../constant';\nimport {Coordinate} from \"../types\";\n\nconst currentCoordinateRegion = createRegion<Coordinate>();\n\nexport const useCurrentCoordinate = currentCoordinateRegion.useValue;\n\nconst setCurrentCoordinate = (coordinate: Coordinate) => {\n    currentCoordinateRegion.set(prev => {\n        if(!prev || prev.x !== coordinate.x || prev.y !== coordinate.y) {\n            return coordinate;\n        }\n        return prev;\n    });\n};\n\nconst resetCurrentCoordinate = currentCoordinateRegion.reset;\n\nconst getCoordinate = (element: HTMLDivElement, clientX: number, clientY: number): Coordinate => {\n    const rect = element.getBoundingClientRect();\n    const mouseX = clientX - rect.left + element.scrollLeft;\n    const mouseY = clientY - rect.top + element.scrollTop;\n    const x = Math.floor(mouseX / size);\n    const y = Math.floor(mouseY / size);\n    return {x, y};\n};\n\ninterface Params {\n    clientX: number;\n    clientY: number;\n}\n\nconst withTouch = (handler: (e: Params) => void) => (e: TouchEvent) => {\n    e.preventDefault();\n    const clientX = e.changedTouches[0].clientX;\n    const clientY = e.changedTouches[0].clientY;\n    handler({clientX, clientY});\n};\n\nconst withMouse = (handler: (e: Params) => void, checkButtons?: boolean) => (e: MouseEvent) => {\n    const clientX = e.clientX;\n    const clientY = e.clientY;\n    if (checkButtons && !e.buttons) {\n        // nothing\n    } else {\n        handler({clientX, clientY});\n    }\n};\n\nconst useEventListener = (ref: RefObject<HTMLDivElement>) => {\n    useEffect(\n        () => {\n            const element = ref.current;\n\n            if (!element) {\n                return;\n            }\n\n            const handleStart = ({clientX, clientY}: Params) => {\n                const coordinate = getCoordinate(element, clientX, clientY);\n                setCurrentCoordinate(coordinate);\n            };\n\n            const handleTouchStart = withTouch(handleStart);\n            const handleMouseDown = withMouse(handleStart);\n\n            const handleMove = ({clientX, clientY}: Params) => {\n                const coordinate = getCoordinate(element, clientX, clientY);\n                setCurrentCoordinate(coordinate);\n                handleBlockClickWithCatch(coordinate);\n            };\n\n            const handleTouchMove = withTouch(handleMove);\n            const handleMouseMove = withMouse(handleMove, true);\n\n            const handleEnd = ({clientX, clientY}: Params) => {\n                const coordinate = getCoordinate(element, clientX, clientY);\n                handleBlockClickWithCatch(coordinate);\n                resetCurrentCoordinate();\n            };\n\n            const handleTouchEnd = withTouch(handleEnd);\n            const handleMouseUp = withMouse(handleEnd);\n\n            // passive false 禁止默认滚动\n            document.body.addEventListener('touchstart', handleTouchStart);\n            document.body.addEventListener('mousedown', handleMouseDown);\n            document.body.addEventListener('touchmove', handleTouchMove, {passive: false});\n            document.body.addEventListener('mousemove', handleMouseMove);\n            document.body.addEventListener('touchend', handleTouchEnd);\n            document.body.addEventListener('mouseup', handleMouseUp);\n\n            return () => {\n                document.body.removeEventListener('touchstart', handleTouchStart);\n                document.body.removeEventListener('mousedown', handleMouseDown);\n                document.body.removeEventListener('touchmove', handleTouchMove);\n                document.body.removeEventListener('mousemove', handleMouseMove);\n                document.body.removeEventListener('touchend', handleTouchEnd);\n                document.body.removeEventListener('mouseup', handleMouseUp);\n            };\n        },\n        [ref]\n    );\n\n    return ref;\n};\n\nexport default useEventListener;\n","import {memo} from \"react\";\nimport {useCurrentCoordinate} from \"./useEventListener\";\nimport {castRangeStyle, intelligenceLevel, size} from '../constant';\nimport c from './CastRange.module.css';\n\nfunction CastRange() {\n    const currentCoordinate = useCurrentCoordinate();\n    if (intelligenceLevel < 3) {\n        return null;\n    }\n    if (!currentCoordinate) {\n        return null;\n    }\n    const {x, y} = currentCoordinate;\n    return <div className={c.castRange} style={{...castRangeStyle, left: (x - 1) * size, top: (y - 1) * size}} />;\n}\n\nexport default memo(CastRange);\n","import React, {useRef} from 'react';\nimport {getBlockList} from '../region';\nimport {useRender} from '../renderer';\nimport Block from './Block';\nimport c from './App.module.css';\nimport {handleReset} from '../handlers';\nimport {panelStyle} from '../constant';\nimport {xyList} from '../utils';\nimport useEventListener from './useEventListener';\nimport CastRange from \"./CastRange\";\n\nconst App = () => {\n    useRender();\n    const ref = useRef<HTMLDivElement>(null);\n    useEventListener(ref);\n\n    const blockList = getBlockList();\n\n    return (\n        <>\n            <div className={c.header} onMouseUp={handleReset} onTouchEnd={handleReset}>\n                {blockList.filter(item => item.mine && !item.mark).length}\n            </div>\n            <div className={c.content}>\n                <div\n                    className={c.panel}\n                    style={panelStyle}\n                    ref={ref}\n                >\n                    {xyList.map((coordinate) => {\n                        return (\n                            <Block key={`${coordinate.x}-${coordinate.y}`} coordinate={coordinate} />\n                        );\n                    })}\n                    <CastRange />\n                </div>\n            </div>\n        </>\n    );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cover\":\"Theme2_cover__36ss5\",\"reveal\":\"Theme2_reveal__39mE5\",\"mine\":\"Theme2_mine__14msQ\",\"mark\":\"Theme2_mark__6iF2h\",\"label0\":\"Theme2_label0__2jGEp\",\"label1\":\"Theme2_label1__2hOCp\",\"label2\":\"Theme2_label2__r3UQk\",\"label3\":\"Theme2_label3__mbS-v\",\"label4\":\"Theme2_label4__18SBo\",\"label5\":\"Theme2_label5__FTOCM\",\"label6\":\"Theme2_label6__l5Y_m\",\"label7\":\"Theme2_label7__2iKDS\",\"label8\":\"Theme2_label8__1UzQN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"App_content__1dlDM\",\"panel\":\"App_panel__2es-6\",\"header\":\"App_header__14Wxn\"};"],"sourceRoot":""}