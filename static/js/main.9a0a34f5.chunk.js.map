{"version":3,"sources":["components/Block.module.css","utils.ts","constant.ts","region.ts","renderer.ts","components/Block.tsx","handlers.ts","components/useEventListener.tsx","components/App.tsx","index.tsx","components/Theme2.module.css","components/App.module.css"],"names":["module","exports","windowWidth","window","outerWidth","windowHeight","outerHeight","size","Math","floor","yNumber","blockNumber","mineNumber","panelStyle","width","height","blockStyle","xyList","y","x","push","handleMark","block","mark","handleReveal","reveal","mine","getBlockList","forEach","Error","label","getSurroundingBlocks","applyDiff","diff","computeSmartDiff","blocks","sumBy","filter","b","blockRegion","createMappedRegion","getBlock","getValue","useBlock","useValue","setBlock","set","compact","map","blockList","region","createRegion","rerender","v","useRender","addEventListener","Block","coordinate","className","cx","styles","theme","cover","style","start","handleReset","fillMap","mineCount","random","handleSmartRoot","handleBlockClick","i","fillMapUntilValid","handleBlockClickWithCatch","e","console","error","getCoordinate","element","clientX","clientY","rect","getBoundingClientRect","mouseX","left","scrollLeft","mouseY","top","scrollTop","useEventListener","ref","useEffect","current","handleTouchMove","preventDefault","changedTouches","handleMouseMove","buttons","document","body","passive","removeEventListener","App","useRef","c","header","onTouchEnd","item","length","content","panel","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.9a0a34f5.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Block_block__Gscjm\"};","import {Block, Coordinate, Diff} from \"./types\";\nimport {getBlockList, getSurroundingBlocks} from \"./region\";\nimport {sumBy} from \"lodash\";\nimport {intelligenceLevel, xNumber, yNumber} from \"./constant\";\n\nexport const xyList: Array<Coordinate> = [];\n\nfor (let y = 0; y < yNumber; y++) {\n    for (let x = 0; x < xNumber; x++) {\n        xyList.push({x, y});\n    }\n}\n\nexport const handleMark = (block: Block) => {\n    block.mark = true;\n};\n\nexport const handleReveal = (block: Block) => {\n    if (block.reveal) {\n        return;\n    }\n    block.reveal = true;\n    if (block.mine) {\n        getBlockList().forEach(block => {\n            block.reveal = true;\n        });\n        throw new Error('失败');\n    }\n    const {label} = block;\n    if (label === 0) {\n        // 这是一个深搜\n        getSurroundingBlocks(block).forEach(handleReveal);\n    }\n};\n\nexport const applyDiff = (diff: Diff) => {\n    const {mark, reveal} = diff;\n    if(mark) {\n        mark.forEach(handleMark);\n    }\n    if(reveal) {\n        reveal.forEach(handleReveal);\n    }\n};\n\nexport const computeSmartDiff = (block: Block): Diff => {\n    const blocks = getSurroundingBlocks(block);\n    // 如果 reveal 的 block 数量正好，则把未打开的置为 mark\n    if (sumBy(blocks, (block) => block.reveal ? 0 : 1) === block.label) {\n        return {\n            mark: blocks.filter(b => !b.reveal)\n        };\n    }\n\n    if (intelligenceLevel >= 1) {\n        // 如果 mark 的 block 数量正好，则把未打开的置为 reveal\n        if (sumBy(blocks, (block) => block.mark ? 1 : 0) === block.label) {\n            return {\n                reveal: blocks.filter(b => !b.mark)\n            };\n        }\n    }\n    return {};\n};\n","\nexport const windowWidth = window.outerWidth;\nexport const windowHeight = window.outerHeight;\n\nexport const xNumber = 20;\nexport const size = Math.floor(windowWidth / xNumber);\nexport const yNumber = Math.floor(windowHeight * 0.95 / size); // 5vh header\nexport const blockNumber = xNumber * yNumber;\nexport const mineNumber = Math.floor(blockNumber * 0.2);\n// 0 mark，1 smart，2 reveal 时会 smart，3 smart 后会对周围 smart\nexport const intelligenceLevel = 3;\n\nexport const panelStyle = {width: xNumber * size, height: yNumber * size};\nexport const blockStyle = {width: size, height: size};\n","import {compact} from 'lodash';\nimport {createMappedRegion} from 'region-core';\nimport {Block, Coordinate} from './types';\nimport {xyList} from \"./utils\";\n\nconst blockRegion = createMappedRegion<Coordinate, Block>();\n\nexport const getBlock = blockRegion.getValue;\n\nexport const useBlock = blockRegion.useValue;\n\nexport const setBlock = blockRegion.set;\n\nexport const getBlockList = (): Block[] => compact(xyList.map(getBlock));\n\nexport const getSurroundingBlocks = (block: Block) => {\n    const {x, y} = block;\n    const blockList = [\n        getBlock({x: x - 1, y: y - 1}), getBlock({x: x - 1, y: y}), getBlock({x: x - 1, y: y + 1}),\n        getBlock({x: x, y: y - 1}), getBlock({x: x, y: y + 1}),\n        getBlock({x: x + 1, y: y - 1}), getBlock({x: x + 1, y: y}), getBlock({x: x + 1, y: y + 1}),\n    ];\n    return compact(blockList);\n};\n","import {createRegion} from 'region-core';\n\nconst region = createRegion<number>(0);\n\nexport const rerender = () => region.set(v => v + 1);\n\nexport const useRender = region.useValue;\n\nwindow.addEventListener('resize', rerender);\n","import React from 'react';\nimport cx from 'classnames';\nimport styles from './Block.module.css';\nimport theme from './Theme2.module.css';\nimport {useBlock} from \"../region\";\nimport {blockStyle as style} from '../constant';\nimport {Coordinate} from \"../types\";\n\ninterface Props {\n    coordinate: Coordinate\n}\n\nconst Block = ({coordinate}: Props) => {\n    const block = useBlock(coordinate);\n\n    if (!block) {\n        return null;\n    }\n\n    const {mine, reveal, mark, label} = block;\n\n    if (!reveal) {\n        const className = cx(\n            styles.block,\n            theme.cover,\n            {\n                [theme.mark]: mark,\n            }\n        );\n        return (\n            <div\n                className={className}\n                style={style}\n            >\n                {mark && 'm'}\n            </div>\n        );\n    }\n    const className = cx(\n        styles.block,\n        theme.reveal,\n        {\n            [theme[`label${label}`]]: !mine,\n            [theme.mine]: mine,\n        }\n    );\n    return (\n        <div\n            className={className}\n            style={style}\n        >\n            {mine ? '!' :  label}\n        </div>\n    );\n};\n\nexport default Block;\n","import {sumBy} from 'lodash';\nimport {rerender} from './renderer';\nimport {getBlock, setBlock, getBlockList, getSurroundingBlocks} from './region';\nimport {Block, Coordinate} from './types';\nimport {intelligenceLevel, mineNumber, xNumber, yNumber} from \"./constant\";\nimport {xyList, applyDiff, computeSmartDiff, handleReveal} from \"./utils\";\n\nlet start = false;\n\nexport const handleReset = () => {\n    xyList.forEach(({x, y}) => {\n        const block = {\n            x,\n            y,\n            mine: false,\n            reveal: false,\n            mark: false,\n            label: 0,\n        };\n        setBlock({x, y}, block);\n    });\n    start = false;\n    rerender();\n};\n\nhandleReset();\n\nconst fillMap = () => {\n    getBlockList().forEach((block) => {\n        block.mine = false;\n    });\n\n    let mineCount = 0;\n    while (mineCount < mineNumber) {\n        const x = Math.floor(Math.random() * xNumber);\n        const y = Math.floor(Math.random() * yNumber);\n        const block = getBlock({x, y}) as Block;\n        if (!block.mine) {\n            block.mine = true;\n            mineCount ++;\n        }\n    }\n\n    getBlockList().forEach((block) => {\n        const blocks = getSurroundingBlocks(block);\n        block.label = sumBy(blocks, 'mine');\n    });\n};\n\nconst fillMapUntilValid = (block: Block) => {\n    for (let i = 0; i < 100; i++) {\n        fillMap();\n        if (!block.mine && block.label === 0) {\n            return;\n        }\n    }\n};\n\nconst handleSmartRoot = (block: Block) => {\n    const diff = computeSmartDiff(block);\n    applyDiff(diff);\n\n    if (intelligenceLevel >= 3) {\n        const diffList = getSurroundingBlocks(block).filter(block => block.reveal).map(computeSmartDiff);\n        diffList.forEach(applyDiff);\n    }\n};\n\nexport const handleBlockClick = (coordinate: Coordinate) => {\n    const block = getBlock(coordinate);\n    if (!block){\n        return;\n    }\n    if (!start){\n        fillMapUntilValid(block);\n        start = true;\n    }\n    const {reveal} = block;\n    if (reveal) {\n        handleSmartRoot(block);\n    } else {\n        handleReveal(block);\n        if (intelligenceLevel >= 2) {\n            handleSmartRoot(block);\n        }\n    }\n};\n\nexport const handleBlockClickWithCatch = (coordinate: Coordinate) => {\n    try {\n        handleBlockClick(coordinate);\n    } catch (e) {\n        console.error(e);\n    } finally {\n        rerender();\n    }\n};\n","import {useEffect, RefObject} from 'react';\nimport {handleBlockClickWithCatch} from '../handlers';\nimport {size} from '../constant';\nimport {Coordinate} from \"../types\";\n\nfunction getCoordinate(element: HTMLDivElement, clientX: number, clientY: number): Coordinate {\n    const rect = element.getBoundingClientRect();\n    const mouseX = clientX - rect.left + element.scrollLeft;\n    const mouseY = clientY - rect.top + element.scrollTop;\n    const x = Math.floor(mouseX / size);\n    const y = Math.floor(mouseY / size);\n    return {x, y};\n}\n\nconst useEventListener = (ref: RefObject<HTMLDivElement>) => {\n    useEffect(\n        () => {\n            const element = ref.current;\n\n            if (!element) {\n                return;\n            }\n\n            const handleTouchMove = (e: TouchEvent) => {\n                e.preventDefault();\n                const coordinate = getCoordinate(element, e.changedTouches[0].clientX, e.changedTouches[0].clientY);\n                handleBlockClickWithCatch(coordinate);\n            };\n\n            const handleMouseMove = (e: MouseEvent) => {\n                if (e.buttons) {\n                    const coordinate = getCoordinate(element, e.clientX, e.clientY);\n                    handleBlockClickWithCatch(coordinate);\n                }\n            };\n\n            // passive false 禁止默认滚动\n            document.body.addEventListener('touchmove', handleTouchMove, {passive: false});\n            document.body.addEventListener('touchend', handleTouchMove);\n            document.body.addEventListener('mousemove', handleMouseMove);\n            document.body.addEventListener('mouseup', handleMouseMove);\n\n            return () => {\n                document.body.removeEventListener('touchmove', handleTouchMove);\n                document.body.removeEventListener('touchend', handleTouchMove);\n                document.body.removeEventListener('mousemove', handleMouseMove);\n                document.body.removeEventListener('mouseup', handleMouseMove);\n            };\n        },\n        [ref]\n    );\n\n    return ref;\n};\n\nexport default useEventListener;\n","import React, {useRef} from 'react';\nimport {getBlockList} from '../region';\nimport {useRender} from '../renderer';\nimport Block from './Block';\nimport c from './App.module.css';\nimport {handleReset} from '../handlers';\nimport {panelStyle} from '../constant';\nimport {xyList} from '../utils';\nimport useEventListener from './useEventListener';\n\nconst App = () => {\n    useRender();\n    const ref = useRef<HTMLDivElement>(null);\n    useEventListener(ref);\n\n    const blockList = getBlockList();\n\n    return (\n        <>\n            <div className={c.header} onTouchEnd={handleReset}>\n                {blockList.filter(item => item.mine && !item.mark).length}\n            </div>\n            <div className={c.content}>\n                <div\n                    className={c.panel}\n                    style={panelStyle}\n                    ref={ref}\n                >\n                    {xyList.map((coordinate) => {\n                        return (\n                            <Block key={`${coordinate.x}-${coordinate.y}`} coordinate={coordinate} />\n                        );\n                    })}\n                </div>\n            </div>\n        </>\n    );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cover\":\"Theme2_cover__36ss5\",\"reveal\":\"Theme2_reveal__39mE5\",\"mine\":\"Theme2_mine__14msQ\",\"mark\":\"Theme2_mark__6iF2h\",\"label0\":\"Theme2_label0__2jGEp\",\"label1\":\"Theme2_label1__2hOCp\",\"label2\":\"Theme2_label2__r3UQk\",\"label3\":\"Theme2_label3__mbS-v\",\"label4\":\"Theme2_label4__18SBo\",\"label5\":\"Theme2_label5__FTOCM\",\"label6\":\"Theme2_label6__l5Y_m\",\"label7\":\"Theme2_label7__2iKDS\",\"label8\":\"Theme2_label8__1UzQN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"App_content__1dlDM\",\"panel\":\"App_panel__2es-6\",\"header\":\"App_header__14Wxn\"};"],"sourceRoot":""}