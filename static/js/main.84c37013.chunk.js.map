{"version":3,"sources":["Block.module.css","App.module.css","useWindowWidth.ts","renderer.ts","region.ts","Block.tsx","App.tsx","index.tsx","Theme2.module.css"],"names":["module","exports","getWindowWidth","window","outerWidth","useWindowWidth","useState","windowWidth","setWindowWidth","useEffect","updateWindowWidth","addEventListener","removeEventListener","region","createRegion","useRender","useValue","blockRegion","createMappedRegion","getBlock","x","y","getValue","getBlockList","arr","i","getXY","push","start","Math","floor","getSurroundingBlocks","block","blockList","compact","createBlock","mine","reveal","mark","label","set","resetMap","fillMap","mineCount","random","forEach","blocks","sumBy","handleMark","handleReveal","console","error","handleBlockClick","fillMapUntilValid","filter","b","handleSmart","v","Block","style","handleClick","useCallback","className","cx","styles","theme","cover","onClick","App","ref","useRef","containerStyle","width","size","blockStyle","height","handleMouseMove","e","buttons","element","current","mouseX","pageX","offsetLeft","mouseY","pageY","offsetTop","handleBlockMove","container","onMouseMove","map","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.84c37013.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Block_block__iCjDP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"App_container__1MQN3\"};","import {useState, useEffect} from 'react';\n\nconst getWindowWidth = () => {\n    return window.outerWidth;\n}\n\nconst useWindowWidth = () => {\n    const [windowWidth, setWindowWidth] = useState<number>(getWindowWidth);\n    useEffect(\n        () => {\n            const updateWindowWidth = () => setWindowWidth(getWindowWidth());\n            window.addEventListener('resize', updateWindowWidth);\n            return () => window.removeEventListener('resize', updateWindowWidth);\n        }\n    );\n    return windowWidth;\n}\n\nexport default useWindowWidth;\n","import {createRegion} from 'region-core';\n\nconst region = createRegion<number>(0)\n\nexport const rerender = () => region.set(v => v+1);\n\nexport const useRender = region.useValue;\n","import {sumBy, compact} from 'lodash';\nimport {createMappedRegion} from 'region-core';\nimport {rerender} from './renderer';\nimport {Block} from './types';\n\nconst blockRegion = createMappedRegion<{x: number, y: number}, Block>();\n\nconst getBlock = (x: number, y: number) => blockRegion.getValue({x, y}) as Block;\n\nexport const getBlockList = (): Block[] => {\n    const arr: Block[] = []\n    for (let i = 0; i < 1000; i++) {\n        const [x, y] = getXY(i);\n        arr.push(getBlock(x, y))\n    }\n    return arr;\n}\n\nlet start = false;\n\nconst getXY = (i: number) => {\n    return [i % 10, Math.floor(i / 10)]\n}\n\nconst getSurroundingBlocks = (block: Block) => {\n    const {x, y} = block;\n    const blockList = [\n        getBlock(x - 1, y - 1), getBlock(x - 1, y), getBlock(x - 1, y + 1),\n        getBlock(x, y - 1), getBlock(x, y + 1),\n        getBlock(x + 1, y - 1), getBlock(x + 1, y), getBlock(x + 1, y + 1),\n    ]\n    return compact(blockList);\n}\n\nconst createBlock = (i: number): Block => {\n    const [x, y] = getXY(i);\n    return {\n        x,\n        y,\n        mine: false,\n        reveal: false,\n        mark: false,\n        label: 0,\n    }\n}\n\nconst resetMap = () => {\n    for (let i = 0; i < 1000; i++) {\n        const block = createBlock(i)\n        blockRegion.set({x: block.x, y: block.y}, block);\n    }\n}\n\nresetMap();\n\nconst fillMap = () => {\n    // x, y mine = false\n    // Object.values(blockMap).forEach((block) => {\n    //     block.mine = false\n    // })\n\n    let mineCount = 0;\n    while (mineCount < 150) {\n        const i = Math.floor(Math.random() * 1000)\n        const [x, y] = getXY(i)\n        const block = blockRegion.getValue({x, y}) as Block\n        if (!block.mine) {\n            block.mine = true;\n            mineCount ++;\n        }\n    }\n\n    getBlockList().forEach((block) => {\n        const blocks = getSurroundingBlocks(block);\n        block.label = sumBy(blocks, 'mine')\n    })\n}\n\nconst fillMapUntilValid = (block: Block) => {\n    for (let i = 0; i < 100; i++) {\n        fillMap();\n        if (!block.mine && block.label === 0) {\n            return\n        }\n    }\n}\n\nconst handleMark = (block: Block) => {\n    block.mark = true;\n}\n\nconst handleReveal = (block: Block) => {\n    if (block.reveal) {\n        return;\n    }\n    block.reveal = true;\n    if (block.mine) {\n        console.error('失败')\n        getBlockList().forEach(block => {\n            block.reveal = true;\n        })\n        return;\n    }\n    const {label} = block\n    if (label === 0) {\n        // 这是一个深搜\n        getSurroundingBlocks(block).forEach(handleReveal)\n    }\n}\n\nconst handleSmart = (block: Block) => {\n    const blocks = getSurroundingBlocks(block);\n    // 如果 reveal 的 block 数量正好，则把未打开的置为 mark\n    if (sumBy(blocks, (block) => block.reveal ? 0 : 1) === block.label) {\n        blocks.filter(b => !b.reveal).forEach(handleMark);\n        return;\n    }\n    // 如果 mark 的 block 数量正好，则把未打开的置为 reveal\n    if (sumBy(blocks, (block) => block.mark ? 1 : 0) === block.label) {\n        blocks.filter(b => !b.mark).forEach(handleReveal)\n    }\n}\n\nexport const handleBlockClick = (block: Block) => {\n    if (!start){\n        fillMapUntilValid(block);\n        start = true\n    }\n    const {reveal} = block\n    if (reveal) {\n        handleSmart(block);\n    } else {\n        handleReveal(block);\n    }\n    rerender()\n}\n\nexport const handleBlockMove = (x: number, y: number) => {\n    const block = getBlock(x, y);\n    if (block) {\n        handleBlockClick(block)\n    }\n}\n","import React, {CSSProperties, useCallback} from 'react';\nimport cx from 'classnames';\nimport {Block as BlockType} from './types';\nimport styles from './Block.module.css';\nimport theme from './Theme2.module.css';\nimport {handleBlockClick} from \"./region\";\n\ninterface Props {\n    block: BlockType\n    style: CSSProperties\n}\n\nconst Block = ({block, style}: Props) => {\n    const {mine, reveal, mark, label} = block;\n    const handleClick = useCallback(\n        () => handleBlockClick(block),\n        [block]\n    )\n    if (!reveal) {\n        const className = cx(\n            styles.block,\n            theme.cover,\n            {\n                [theme.mark]: mark,\n            }\n        )\n        return (\n            <div\n                className={className}\n                style={style}\n                onClick={handleClick}\n            >\n                {mark && 'm'}\n            </div>\n        )\n    }\n    const className = cx(\n        styles.block,\n        theme.reveal,\n        {\n            [theme[`label${label}`]]: !mine,\n            [theme.mine]: mine,\n        }\n    )\n    return (\n        <div\n            className={className}\n            style={style}\n            onClick={handleClick}\n        >\n            {mine ? '!' :  label}\n        </div>\n    )\n}\n\nexport default Block;\n","import React, {useCallback, useRef} from 'react';\nimport useWindowWidth from './useWindowWidth';\nimport {getBlockList, handleBlockMove} from './region';\nimport {useRender} from './renderer';\nimport Block from './Block';\nimport {Block as BlockType} from './types';\nimport styles from './App.module.css';\n\nconst App = () => {\n  useRender()\n  const ref = useRef<HTMLDivElement>(null)\n  const windowWidth = useWindowWidth();\n  const containerStyle = {width: windowWidth < 400 ? windowWidth : 400}\n  const size = containerStyle.width / 10\n  const blockStyle = {width: size, height: size};\n\n  const handleMouseMove = useCallback(\n      (e) => {\n          if (e.buttons) {\n              const element = ref.current as HTMLDivElement;\n              const mouseX = e.pageX - element.offsetLeft\n              const mouseY = e.pageY - element.offsetTop\n              const x = Math.floor(mouseX / size)\n              const y = Math.floor(mouseY / size)\n              handleBlockMove(x, y);\n          }\n      },\n      [size]\n  )\n\n  return (\n      <div\n          className={styles.container}\n          style={containerStyle}\n          ref={ref}\n          onMouseMove={handleMouseMove}\n      >\n        {getBlockList().map((block: BlockType) => {\n          const {x, y} = block\n          return (\n              <Block key={`${x}-${y}`} block={block} style={blockStyle} />\n          )\n        })}\n      </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// serviceWorker.register();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cover\":\"Theme2_cover__3865b\",\"reveal\":\"Theme2_reveal__1EBmM\",\"mine\":\"Theme2_mine__3IuD1\",\"mark\":\"Theme2_mark__3Tzcm\",\"label0\":\"Theme2_label0__3RWIe\",\"label1\":\"Theme2_label1__2ZQ5E\",\"label2\":\"Theme2_label2__3qBuF\",\"label3\":\"Theme2_label3__2CRCO\",\"label4\":\"Theme2_label4__3JfsB\",\"label5\":\"Theme2_label5__10eKI\",\"label6\":\"Theme2_label6__1_WrO\",\"label7\":\"Theme2_label7__2QVoS\",\"label8\":\"Theme2_label8__3yYkG\"};"],"sourceRoot":""}